<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hawaii COVID19 Charts & Statistics | Resilient Hawaii</title>
  <meta name="description" content="Charts & Statistics specific to Hawaii concerning the novel coronavirus global pandemic (COVID-19/SARS-CoV-2)" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/chart.js@2.9.3/dist/Chart.min.css,npm/tachyons@4.11.1" />
  <style>
    #cover {
      background: url("/media/img/spinner.gif") no-repeat scroll center center #FFF;
      position: absolute;
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.4.1,npm/moment@2.24.0,npm/chart.js@2.9.3,npm/chartjs-plugin-datalabels@0.7.0"></script>
  <script>
    var NUM_DAYS = 21;

    var DATE_ROW_INDEX = 0;
    var CASES_ROW_INDEX = 1;
    var OAHU_TOTAL_CASES_ROW_INDEX = 2;
    var MAUI_TOTAL_CASES_ROW_INDEX = 3;
    var BI_TOTAL_CASES_ROW_INDEX = 4;
    var KAUAI_TOTAL_CASES_ROW_INDEX = 5;
    var HOSPITALIZED_ROW_INDEX = 6;
    var DEATHS_ROW_INDEX = 7;
    var RECOVERED_ROW_INDEX = 8;
    var TOTAL_TESTED_ROW_INDEX = 9;
    var TOTAL_TESTED_POSITIVE_ROW_INDEX = 11;

    var covidData;

    function _getIndexOfConsecutiveRows(data) {
      var currentIndex = 0;

      for (var i = data.length - 1; i > 0; i--) {
        if ((data[i] !== null) && (data[i][DATE_ROW_INDEX] !== null) && (data[i-1][DATE_ROW_INDEX] !== null)) {
          currentIndex = i;
          break;
        }
      }
      return currentIndex;
    }

    function updateTotal(currentTotal, previousTotal, totalId, newTotalId, percentChangeId) {
      var difference = currentTotal - previousTotal;
      var percentChange = Number(Math.round(((difference / previousTotal) * 100) + 'e' + 2) +'e-'+ 2);

      $('#' + totalId).text(currentTotal);
      $('#' + newTotalId).text("+" + difference);
      if (percentChange != 0) {
        $('#' + percentChangeId).addClass((percentChange > 0) ? 'dark-red' : 'dark-green');
        $('#' + percentChangeId).html((percentChange> 0) ? "&#8599;&nbsp;" + percentChange + "%": "&#8600;&nbsp;" + percentChange);
      } else {
        $('#' + percentChangeId).html("-");
      }
    }

    function populateStateDashboard(data) {
      if ('rows' in data) {
        var numRowsToGet = 5;
        var lastNumRows = data.rows.slice(1).slice(-1 * numRowsToGet);
        var currentIndex = _getIndexOfConsecutiveRows(lastNumRows);

        if (currentIndex > 0) {

          var current = lastNumRows[currentIndex];
          var previous = lastNumRows[currentIndex-1];

          updateTotal(current[CASES_ROW_INDEX], previous[CASES_ROW_INDEX], 'state_total_cases', 'state_new_cases', 'state_percent_change_cases');
          updateTotal(current[DEATHS_ROW_INDEX], previous[DEATHS_ROW_INDEX], 'state_total_deaths', 'state_new_deaths', 'state_percent_change_deaths');

          $('#data_updated').text(current[0]);
        }
      }
    }

    function populateIslandDashboard(data) {
      if ('rows' in data) {
        var numRowsToGet = 5;
        var lastNumRows = data.rows.slice(1).slice(-1 * numRowsToGet);
        var currentIndex = _getIndexOfConsecutiveRows(lastNumRows);

        if (currentIndex > 0) {

          var current = lastNumRows[currentIndex];
          var previous = lastNumRows[currentIndex-1];

          updateTotal(current[OAHU_TOTAL_CASES_ROW_INDEX], previous[OAHU_TOTAL_CASES_ROW_INDEX], 'oahu_total_cases', 'oahu_new_cases', 'oahu_percent_change_cases');
          updateTotal(current[MAUI_TOTAL_CASES_ROW_INDEX], previous[MAUI_TOTAL_CASES_ROW_INDEX], 'maui_total_cases', 'maui_new_cases', 'maui_percent_change_cases');
          updateTotal(current[BI_TOTAL_CASES_ROW_INDEX], previous[BI_TOTAL_CASES_ROW_INDEX], 'bi_total_cases', 'bi_new_cases', 'bi_percent_change_cases');
          updateTotal(current[KAUAI_TOTAL_CASES_ROW_INDEX], previous[KAUAI_TOTAL_CASES_ROW_INDEX], 'kauai_total_cases', 'kauai_new_cases', 'kauai_percent_change_cases');
        }
      }
    }

    function populateDailyCases(data, chart) {
      if ('rows' in data) {
        data.rows.slice(1).slice(-1 * NUM_DAYS).forEach(function (item, index) {
          if (item[DATE_ROW_INDEX] !== null) {
            chart.data.labels.push(moment(item[0]).format('MM/DD/YY'));
            chart.data.datasets[0].data.push(item[OAHU_TOTAL_CASES_ROW_INDEX]);
            chart.data.datasets[1].data.push(item[MAUI_TOTAL_CASES_ROW_INDEX]);
            chart.data.datasets[2].data.push(item[BI_TOTAL_CASES_ROW_INDEX]);
            chart.data.datasets[3].data.push(item[KAUAI_TOTAL_CASES_ROW_INDEX]);
            chart.data.datasets[4].data.push(item[CASES_ROW_INDEX]);
            chart.update();
          }
        });
      }
    }

    function populateTestChart(data, chart) {
      if ('rows' in data) {
        data.rows.slice(1).slice(-1 * NUM_DAYS).forEach(function (item, index) {
          if (item[DATE_ROW_INDEX] !== null) {
            chart.data.labels.push(moment(item[0]).format('MM/DD/YY'));
            chart.data.datasets[0].data.push(parseInt(item[TOTAL_TESTED_POSITIVE_ROW_INDEX]));
            if (item[TOTAL_TESTED_ROW_INDEX] !== null) {
              chart.data.datasets[1].data.push(parseInt(item[TOTAL_TESTED_ROW_INDEX].replace(/,/g, ''), 10));
            } else {
              chart.data.datasets[1].data.push(item[TOTAL_TESTED_ROW_INDEX]);
            }
            chart.update();
          }
        });
      }
    }

    function populateHospitalizedChart(data, chart) {
      if ('rows' in data) {
        data.rows.slice(1).slice(-1 * NUM_DAYS).forEach(function (item, index) {
          if (item[DATE_ROW_INDEX] !== null) {
            chart.data.labels.push(moment(item[0]).format('MM/DD/YY'));
            chart.data.datasets[0].data.push(parseInt(item[HOSPITALIZED_ROW_INDEX]));
            chart.data.datasets[1].data.push(parseInt(item[RECOVERED_ROW_INDEX]));
            chart.data.datasets[2].data.push(parseInt(item[DEATHS_ROW_INDEX]));
            chart.update();
          }
        });
      }
    }

    function populateCasesSpark(data, chart) {
      _populateChartWithIndex(data, NUM_DAYS, chart, CASES_ROW_INDEX);
    }

    function populateDeathsSpark(data, chart) {
      _populateChartWithIndex(data, NUM_DAYS, chart, DEATHS_ROW_INDEX);
    }

    function populateHospitalizedSpark(data, chart) {
      _populateChartWithIndex(data, NUM_DAYS, chart, HOSPITALIZED_ROW_INDEX);
    }

    function populateTestedSpark(data, chart) {
      _populateChartWithIndex(data, NUM_DAYS, chart, TOTAL_TESTED_ROW_INDEX);
    }

    function _populateChartWithIndex(data, numData, chart, rowIndex) {
      if ('rows' in data) {
        data.rows.slice(1).slice(-1 * numData).forEach(function (item, index) {
          if (item[DATE_ROW_INDEX] !== null) {
            chart.data.labels.push(moment(item[DATE_ROW_INDEX]).format('MM/DD/YY'));
            chart.data.datasets[0].data.push(parseInt(item[rowIndex]));
            chart.update();
          }
        });
      }
    }

    function getSparkOptions(title) {
      return {
        responsive: true,
        maintainAspectRatio: false,
        elements: {
          line: {
            borderColor: '#000000',
            borderWidth: 1
          },
          point: {
            radius: 0
          }
        },
        tooltips: {
          enabled: false
        },
        title: {
          display: true,
          text: title,
          fontSize: 32,
          fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial'",
          fontColor: '#333',
        },
        legend: {
          display: false,
        },
        scales: {
          yAxes: [{
            stacked: true,
            display: false
          }],
          xAxes: [{
            stacked: true,
            type: 'time',
            time: {
              unit: 'month'
            },
          }]
        }
      };
    }

    function getCovidDataFromApi() {
      $.ajax({
        url: 'https://covid19-hawaii.herokuapp.com/hawaii_daily.sqlite?sql=select+Date%2C+%5BTotal+Cases%5D%2C+%5BTotal+Oahu+Res%5D%2C+%5BTotal+Maui+Res%5D%2C+%5BTotal+HIsland+Res%5D%2C+%5BTotal+Kauai+Res%5D%2C+%5BTotal+Hosp%5D%2C+%5BTotal+Deaths%5D%2C+%5BTotal+Released%5D%2C+%5BTotal+Tests%5D%2C+%5BNegative+Tests%5D%2C+%5BPositive+Tests%5D+from+hawaii_daily+order+by+rowid&_format=json',
        success: function(data) {
          $('#cover').fadeOut(3000);
          covidData = data;
          populateStateDashboard(covidData);
          populateIslandDashboard(covidData);

          populateCasesSpark(covidData, casesSparkChart);
          populateDeathsSpark(covidData, deadSparkChart);
          populateHospitalizedSpark(covidData, hospitalizedSparkChart);
          populateTestedSpark(covidData, testedSparkChart);

          populateDailyCases(covidData, dailyCasesChart);
          populateTestChart(covidData, testChart);
          populateHospitalizedChart(covidData, hospitalizedChart);
        }
      });
    }

    $(document).ready(function() {
      Chart.plugins.unregister(ChartDataLabels);
      getCovidDataFromApi();
    });
  </script>
</head>
<body class="system-sans-serif">
  <header class="w-100 ph3 pv3" style="background-color:#00b8bd"></header>
  <div id="cover"></div>
  <div class="w-50 mw4-ns tc center mt3">
    <a href="https://resilienthawaii.org"><img src="/media/img/logo-color.png"/></a>
  </div>
  <h1 class="avenir tc f-subheadline lh-title">HAWAII COVID-19 CHARTS</h1>
  <div class="w-75 mw8-ns tc center mb5 mid-gray">
    <p>
    The data contained within these visualizations are being fed by the <a href="https://covid19-hawaii.herokuapp.com">Hawaii COVID19 API</a> that is serving the data contained within the community maintained Google Doc, <a href="https://docs.google.com/spreadsheets/u/1/d/1WTUg75_mm35Z2C6PQd5AOKtVeSNfci5Mp0G_pgYTqQI/">Daily Hawaii COVID-19 Cases</a>.
    </p>
    <p class="b black">
    Disclaimer: Like everything else you read on the internet, <span class="dark-red"> please check the source to make sure it’s up to date.</span>
    </p>
  </div>
  <div class="cf mw8-ns tc center bg-light-gray pa4 ba b--light-silver mb4">
    <div class="fl w-50-ns w-100 mb3 bb bn-ns b--light-silver">
      <div class="pa4 pa2-ns">
        <div class="f3 mb3">State Cases</div>
        <div class="f1" id="state_total_cases"></div>
        <div class="f4">
          <span id="state_new_cases"></span>
          (<span id="state_percent_change_cases"></span>)
        </div>
      </div>
    </div>
    <div class="fl w-50-ns w-100 mb3">
      <div class="pa4 pa2-ns">
        <div class="f3 mb3">State Deaths</div>
        <div class="f1" id="state_total_deaths"></div>
        <div class="f4">
          <span id="state_new_deaths"></span>
          (<span id="state_percent_change_deaths"></span>)
        </div>
      </div>
    </div>
    <div class="w-100 dark-gray">Last Updated: <span class="bold" id="data_updated"></div>
  </div>
  <div class="cf mw8-ns tc center pa4 bb-ns b--light-silver">
    <div class="fl w-25-ns w-100 mb3 br-ns bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <img class="bg-dark-gray mb3 w-80" src="/media/img/honolulu.svg" />
        <div class="f3 mb3">Honolulu</div>
        <div class="f1" id="oahu_total_cases"></div>
        <div class="f4">
          <span id="oahu_new_cases"></span>
          (<span id="oahu_percent_change_cases"></span>)
        </div>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 br-ns bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <img class="bg-dark-gray mb3 w-80" src="/media/img/hawaii.svg" />
        <div class="f3 mb3">Hawaii</div>
        <div class="f1" id="bi_total_cases"></div>
        <div class="f4">
          <span id="bi_new_cases"></span>
          (<span id="bi_percent_change_cases"></span>)
        </div>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <img class="bg-dark-gray mb3 w-80" src="/media/img/kauai.svg" />
        <div class="f3 mb3">Kauai</div>
        <div class="f1" id="kauai_total_cases"></div>
        <div class="f4">
          <span id="kauai_new_cases"></span>
          (<span id="kauai_percent_change_cases"></span>)
        </div>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns">
        <img class="bg-dark-gray mb3 w-80" src="/media/img/maui.svg" />
        <div class="f3 mb3">Maui</div>
        <div class="f1" id="maui_total_cases"></div>
        <div class="f4">
          <span id="maui_new_cases"></span>
          (<span id="maui_percent_change_cases"></span>)
        </div>
      </div>
    </div>
  </div>
  <div class="cf mw8-ns tc center pa4 bb-ns b--light-silver">
    <div class="w-100 mb5">
      <div class="center w-50 w-25-ns br-pill bg-dark-gray pa2 white shadow-3">STATEWIDE</div>
    </div>
    <div class="fl w-25-ns w-100 mb3 bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns">
        <canvas id="cases_spark" height="200px"></canvas>
        <script>
          var casesSparkCtx = document.getElementById('cases_spark').getContext('2d');
          var casesSparkChart = new Chart(casesSparkCtx, {
            type: 'line',
            data: {
              labels: [],
              datasets: [{
                data: [],
                fill: true,
                color: '#000'
              }]
            },
            options: getSparkOptions('Cases')
          });
        </script>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 br-ns bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <canvas id="dead_spark" height="200"></canvas>
        <script>
          var deadSparkCtx = document.getElementById('dead_spark').getContext('2d');
          var deadSparkChart = new Chart(deadSparkCtx, {
            type: 'line',
            data: {
              labels: [],
              datasets: [{
                data: [],
                fill: true,
                color: '#000'
              }]
            },
            options: getSparkOptions('Deaths')
          });
        </script>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 br-ns bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <canvas id="hospitalized_spark" height="200px"></canvas>
        <script>
          var hospitalizedSparkCtx = document.getElementById('hospitalized_spark').getContext('2d');
          var hospitalizedSparkChart = new Chart(hospitalizedSparkCtx, {
            type: 'line',
            data: {
              labels: [],
              datasets: [{
                data: [],
                fill: true,
                color: '#000'
              }]
            },
            options: getSparkOptions('Hospitalized')
          });
        </script>
      </div>
    </div>
    <div class="fl w-25-ns w-100 mb3 br-ns bn-ns bb b--light-silver">
      <div class="pa4 pa2-ns br-ns b--light-silver">
        <canvas id="tested_spark" height="200px"></canvas>
        <script>
          var testedSparkCtx = document.getElementById('tested_spark').getContext('2d');
          var testedSparkChart = new Chart(testedSparkCtx, {
            type: 'line',
            data: {
              labels: [],
              datasets: [{
                data: [],
                fill: true,
                color: '#000'
              }]
            },
            options: getSparkOptions('Tested')
          });
        </script>
      </div>
    </div>
  </div>
  <div class="cf mw8-ns tc center pa4 bb-ns bb b--light-silver">
    <div class="w-100 mb2">
      <canvas id="daily_cases" height="200"></canvas>
      <script>
        var dailyCasesCtx = document.getElementById('daily_cases').getContext('2d');
        var dailyCasesChart = new Chart(dailyCasesCtx, {
          plugins: [
            ChartDataLabels,
            {
              afterUpdate: function(chart) {
              for (var i = 0; i < chart.config.data.datasets.length; i++) {
                var dataset = chart.config.data.datasets[i];
                var offset = -40;
                for (var j = 0; j < dataset._meta[4].data.length; j++) {
                    var model = dataset._meta[4].data[j]._model;
                    model.x += offset;
                    model.controlPointNextX += offset;
                    model.controlPointPreviousX += offset;
                }
              }}
            }
          ],
          type: 'bar',
          data: {
            labels: [],
            datasets: [
            {
              data: [],
              label: 'Oahu',
              backgroundColor: '#5899DA'
            },
            {
              data: [],
              label: 'Maui/Molokai/Lanai',
              backgroundColor: '#E8743B'
            },
            {
              data: [],
              label: 'Hawaii',
              backgroundColor: '#19A979'
            },
            {
              data: [],
              label: 'Kauai',
              backgroundColor: '#6C8893',
            },
            {
              data: [],
              label: 'Total',
              type: 'line',
              fill: false,
              color: '#000'
            }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            showScale: false,
            title: {
              display: true,
              text: "Daily COVID-19 Cases By Island",
              fontSize: 32,
              fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial'",
              fontColor: '#333',
            },
            legend: {
              display: true,
              labels: {
                fontColor: '#000',
                fontSize: 24
              }
            },
            scales: {
              yAxes: [{
                stacked: true,
                ticks: {
                  beginAtZero: false,
                }
              }],
              xAxes: [{
                stacked: true,
                type: 'time',
                time: {
                  unit: 'month'
                },
                barThickness: 'flex',
              }]
            }
          }
        });
      </script>
    </div>
  </div>
  <div class="cf mw8-ns tc center pa4 bb-ns bb b--light-silver">
    <div class="w-100 mb5">
      <canvas id="hospitalized_chart" height="200"></canvas>
      <script>
        var hospitalizedContext = document.getElementById('hospitalized_chart').getContext('2d');
        var hospitalizedChart = new Chart(hospitalizedContext, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
            {
              data: [],
              label: 'Total Hospitalized',
              backgroundColor: '#5899DA',
              order: 3,
            },
            {
              data: [],
              label: 'Total Recovered',
              backgroundColor: '#19A979',
              fill: 0
            },
            {
              data: [],
              label: 'Total Deaths',
              backgroundColor: '#E8743B',
              fill: 'origin'
            },
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            showScale: false,
            title: {
              display: true,
              text: "Daily Hospital Results",
              fontSize: 32,
              fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial'",
              fontColor: '#333',
            },
            legend: {
              display: true,
              labels: {
                fontColor: '#000',
                fontSize: 24
              }
            },
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: false,
                }
              }],
              xAxes: [{
                stacked: true,
                type: 'time',
                time: {
                  unit: 'month'
                },
              }]
            }
          }
        });
      </script>
    </div>
  </div>
  <div class="cf mw8-ns tc center pa4 bb-ns bb b--light-silver">
    <div class="w-100 mb5">
      <canvas id="test_chart" height="200"></canvas>
      <script>
        var testCtx = document.getElementById('test_chart').getContext('2d');
        var testChart = new Chart(testCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
            {
              data: [],
              label: 'Positive',
              backgroundColor: '#E8743B',
              fill: true
            },
            {
              data: [],
              label: 'Tested',
              backgroundColor: '#5899DA',
              fill: true
            },
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            showScale: false,
            title: {
              display: true,
              text: "COVID19 Test Results",
              fontSize: 32,
              fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial'",
              fontColor: '#333',
            },
            legend: {
              display: true,
              labels: {
                fontColor: '#000',
                fontSize: 24
              }
            },
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: false,
                }
              }],
              xAxes: [{
                stacked: true,
                type: 'time',
                time: {
                  unit: 'month'
                },
              }]
            }
          }
        });
      </script>
    </div>
  </div>
  <div class="w-75 f6 tc center mv5 mid-gray"><p>These charts are brought to you by the letters S,T,A,Y @ home. <a href="https://resilienthawaii.org">Resilient Hawaii</a></p></div>
  <script data-goatcounter="https://resilienthawaii-charts.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>

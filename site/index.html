<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/chart.js@2.9.3/dist/Chart.min.css,npm/tachyons@4.11.1" />
  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.4.1,npm/chart.js@2.9.3"></script>
</head>
<body>
  <article class="athelas">
    <div
      class="vh-100 dt w-100 tc bg-dark-gray white cover"
      style="background:url(http://mrmrs.github.io/photos/u/009.jpg) no-repeat center;"
    >
      <div class="dtc v-mid">
        <header class="white-70">
          <h2 class="f3 fw1 ttu tracked mb2 lh-title">
            Hawaii COVID-19 Charts
          </h2>
        </header>
        <blockquote class="ph0 mh0 measure f4 lh-copy center">
          <cite class="f6 ttu tracked fs-normal">Code for Hawaii</cite>
        </blockquote>
      </div>
    </div>
    <div class="center measure-wide f5 pv5 lh-copy ph2">
      <h1 class="f1 lh-title"></h1>
      <p>
        <canvas id="cases" width="100%" height="100px"></canvas>
        <script>
          var ctx = document.getElementById('cases').getContext('2d');
          var lineChart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: [],
              datasets: [{
                data: [],
                borderWidth: 1,
                borderColor:'#00c0ef',
                label: 'liveCount',
              }]
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: "Daily COVID-19 Cases in Hawaii (Last 21 days)"
              },
              legend: {
                display: false
              },
              scales: {
                yAxes: [{
                  ticks: {
                    beginAtZero: true,
                  }
                }]
              }
            }
          });
          var getData = function() {
            $.ajax({
              url: 'http://covid19-hawaii.herokuapp.com/hawaii_daily.sqlite?sql=select+Date%2C+%22Total+Cases%22+from+hawaii_daily&_format=json',
              success: function(data) {
                if ('rows' in data) {
                  data.rows.slice(1).slice(-21).forEach(function (item, index) {
                    lineChart.data.labels.push(item[0]);
                    lineChart.data.datasets[0].data.push(item[1]);
                    lineChart.update();
                  });
                }
              }
            });
          };
          getData();
        </script>
      </p>
    </div>
  </article>
</body>
</html>
